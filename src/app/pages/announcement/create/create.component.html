<app-header></app-header>
<div class="mt-10 px-4">
  <div *ngIf="errorMsg" class="mb-4">
    <p class="text-xl font-semibold text-center text-red-600">
      {{ errorMsg }}
    </p>
  </div>
  <div *ngIf="successMsg" class="mb-4">
    <p class="text-xl font-semibold text-center text-green-600">
      {{ successMsg }}
    </p>
  </div>

  <form
    [formGroup]="createAnnoucmentForm"
    (ngSubmit)="onSubmit()"
    class="space-y-6 bg-white p-8 rounded-2xl shadow-lg max-w-3xl mx-auto border border-gray-100"
  >
    <!-- Titre -->
    <div>
      <label for="title" class="block text-sm font-semibold text-gray-700 mb-2">Titre</label>
      <input
        id="title"
        type="text"
        formControlName="title"
        placeholder="Titre de l'annonce"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      />
    </div>

    <!-- Description -->
    <div>
      <label for="desc" class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
      <textarea
        id="desc"
        formControlName="description"
        placeholder="Décrivez votre article..."
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
        rows="4"
      ></textarea>
    </div>

    <!-- Opération -->
    <div>
      <label for="operation_type" class="block text-sm font-semibold text-gray-700 mb-2">Type d'opération</label>
      <select
        id="operation_type"
        formControlName="operation_type"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      >
        <option value="" disabled>-- Sélectionnez --</option>
        <option value="don">Don</option>
        <option value="sale">Vente</option>
        <option value="exchange">Échange</option>
      </select>
    </div>

    <!-- État -->
    <div>
      <label for="state" class="block text-sm font-semibold text-gray-700 mb-2">État du produit</label>
      <select
        id="state"
        formControlName="state"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      >
        <option value="" disabled>-- Sélectionnez --</option>
        <option value="new">Neuf</option>
        <option value="like new">Comme neuf</option>
        <option value="damaged">Abimé</option>
        <option value="good">Bon état</option>
      </select>
    </div>

    <!-- Catégorie -->
    <div>
      <label for="category_id" class="block text-sm font-semibold text-gray-700 mb-2">Catégorie</label>
      <select
        id="category_id"
        formControlName="category_id"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      >
        <option value="" disabled>-- Sélectionnez une catégorie --</option>
        <option *ngFor="let category of categories" [value]="category.id">
          {{ category.name }}
        </option>
      </select>
    </div>

    <!-- Prix -->
    <div *ngIf="createAnnoucmentForm.get('operation_type')?.value === 'sale'">
      <label for="price" class="block text-sm font-semibold text-gray-700 mb-2">Prix</label>
      <input
        id="price"
        type="number"
        formControlName="price"
        placeholder="Ex: 10000"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      />
    </div>

    <!-- Adresse -->
    <div>
      <label for="exchangeAddress" class="block text-sm font-semibold text-gray-700 mb-2">Adresse d’échange</label>
      <input
        id="exchangeAddress"
        type="text"
        formControlName="exchange_location_address"
        class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
      />
    </div>

    <!-- Latitude & Longitude -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label for="exchangeLat" class="block text-sm font-semibold text-gray-700 mb-2">Latitude</label>
        <input
          id="exchangeLat"
          type="text"
          formControlName="exchange_location_lat"
          class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
        />
      </div>
      <div>
        <label for="exchangeLng" class="block text-sm font-semibold text-gray-700 mb-2">Longitude</label>
        <input
          id="exchangeLng"
          type="text"
          formControlName="exchange_location_lng"
          class="w-full px-5 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:outline-none"
        />
      </div>
    </div>

    <!-- Photos -->
    <div>
      <label for="photos" class="block text-sm font-semibold text-gray-700 mb-2">Photos</label>
      <input
        id="photos"
        type="file"
        multiple
        (change)="onFileChange($event)"
        class="w-full"
      />

      <div class="flex flex-wrap gap-4 mt-4" *ngIf="previewImages.length">
        <div *ngFor="let url of previewImages; let i = index" class="relative">
          <img
            [src]="url"
            class="w-24 h-24 object-cover rounded-lg border border-gray-300 shadow-sm"
            alt="Preview"
          />
          <button
            type="button"
            (click)="removeImage(i)"
            class="absolute top-0 right-0 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-700"
            title="Supprimer"
          >
            ×
          </button>
        </div>
      </div>
    </div>

    <!-- Submit -->
    <div>
      <button
        type="submit"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl shadow-md transition duration-300"
      >
        Créer l'annonce
      </button>
    </div>
  </form>
</div>
