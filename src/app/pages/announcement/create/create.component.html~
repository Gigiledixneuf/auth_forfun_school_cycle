<app-header></app-header>
<div class="fixed top-4 right-4 z-50 flex flex-col gap-3 w-80">
  <!-- Toast d'erreur -->
  <div *ngIf="errorMsg" class="bg-white border-l-4 border-red-500 rounded-lg shadow-lg p-4 flex items-start animate-toast-in">
    <div class="flex-shrink-0 text-red-500 mr-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
      </svg>
    </div>
    <div class="flex-1">
      <p class="text-sm font-medium text-red-800">{{ errorMsg }}</p>
    </div>
    <button (click)="errorMsg = ''" class="ml-3 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Toast de succès -->
  <div *ngIf="successMsg" class="bg-white border-l-4 border-green-500 rounded-lg shadow-lg p-4 flex items-start animate-toast-in">
    <div class="flex-shrink-0 text-green-500 mr-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
      </svg>
    </div>
    <div class="flex-1">
      <p class="text-sm font-medium text-green-800">{{ successMsg }}</p>
    </div>
    <button (click)="successMsg = ''" class="ml-3 text-gray-400 hover:text-gray-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
</div>

<div class="min-h-screen bg-white mt-10 mb-10">
  <div class="px-4 max-w-4xl mx-auto pt-8">
    <!-- Formulaire avec en-tête intégré -->
    <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
      <!-- En-tête intégré au formulaire -->
      <div class="bg-gradient-to-r from-[#FF9000] to-[#FF7A00] text-white py-8 px-8">
        <div class="text-center">
          <h1 class="text-3xl font-bold mb-3">Créer une nouvelle annonce</h1>
          <p class="text-lg text-orange-100">
            Partagez les détails de vos fournitures scolaires pour les vendre, échanger ou donner
          </p>
        </div>
      </div>

      <!-- Contenu du formulaire -->
      <form
        [formGroup]="createAnnoucmentForm"
        (ngSubmit)="onSubmit()"
        class="p-8 space-y-8"
      >

        <!-- Section 1: Type d'annonce -->
        <div class="bg-[#FFDFC8] p-6 rounded-xl border border-[#FFD0A9]">
          <div class="flex items-center gap-4 mb-6">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#FF9000] text-white font-bold text-2xl">
              1
            </div>
            <h2 class="text-[#7A4100] text-2xl font-bold">Type d'annonce</h2>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Option Vente -->
            <label class="cursor-pointer">
              <input type="radio" name="operation_type" value="sale" class="sr-only peer" formControlName="operation_type" checked>
              <div class="flex flex-col items-center p-6 border-2 rounded-xl bg-white transition-all peer-checked:border-[#FF9000] peer-checked:ring-2 peer-checked:ring-[#FF9000] hover:border-[#FF9000] hover:shadow-md">
                <div class="text-[#FF9000] mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
                <h3 class="font-semibold text-lg mb-1 text-gray-800">Vente</h3>
                <p class="text-gray-600 text-center text-sm">Vendez vos fournitures à un prix fixe</p>
              </div>
            </label>

            <!-- Option Échange -->
            <label class="cursor-pointer">
              <input type="radio" name="operation_type" value="exchange" formControlName="operation_type" class="sr-only peer">
              <div class="flex flex-col items-center p-6 border-2 rounded-xl bg-white transition-all peer-checked:border-[#FF9000] peer-checked:ring-2 peer-checked:ring-[#FF9000] hover:border-[#FF9000] hover:shadow-md">
                <div class="text-[#FF9000] mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                  </svg>
                </div>
                <h3 class="font-semibold text-lg mb-1 text-gray-800">Échange</h3>
                <p class="text-gray-600 text-center text-sm">Échangez contre d'autres fournitures</p>
              </div>
            </label>

            <!-- Option Don -->
            <label class="cursor-pointer">
              <input type="radio" name="operation_type" value="don" formControlName="operation_type" class="sr-only peer">
              <div class="flex flex-col items-center p-6 border-2 rounded-xl bg-white transition-all peer-checked:border-[#FF9000] peer-checked:ring-2 peer-checked:ring-[#FF9000] hover:border-[#FF9000] hover:shadow-md">
                <div class="text-[#FF9000] mb-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
                  </svg>
                </div>
                <h3 class="font-semibold text-lg mb-1 text-gray-800">Don</h3>
                <p class="text-gray-600 text-center text-sm">Donnez gratuitement à quelqu'un</p>
              </div>
            </label>
          </div>

          <!-- Message d'erreur pour operation_type -->
          <div *ngIf="(isSubmited || createAnnoucmentForm.get('operation_type')?.touched) && createAnnoucmentForm.get('operation_type')?.errors?.['required']" class="mt-2 text-sm text-red-600">
            <span class="font-medium">Erreur :</span> Veuillez sélectionner un type d'annonce.
          </div>
        </div>

        <!-- Section 2: Informations générales -->
        <div class="bg-[#FFDFC8] p-6 rounded-xl border border-[#FFD0A9]">
          <div class="flex items-center gap-4 mb-6">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#FF9000] text-white font-bold text-2xl">
              2
            </div>
            <h2 class="text-[#7A4100] text-2xl font-bold">Informations générales</h2>
          </div>

          <div class="space-y-6">
            <!-- Titre de l'annonce -->
            <div>
              <label for="title" class="block text-sm font-semibold text-[#7A4100] mb-2">Titre de l'annonce</label>
              <input
                id="title"
                type="text"
                formControlName="title"
                placeholder="Ex: Livre de mathématiques 6ème"
                class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white"
                [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('title')?.touched) && createAnnoucmentForm.get('title')?.invalid"
              />
              <div *ngIf="(isSubmited || createAnnoucmentForm.get('title')?.touched) && createAnnoucmentForm.get('title')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> Le titre de l'annonce est requis.
              </div>
              <div *ngIf="(isSubmited || createAnnoucmentForm.get('title')?.touched) && createAnnoucmentForm.get('title')?.errors?.['minlength']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> Le titre doit avoir au moins 5 caractères.
              </div>

              <div *ngIf="(isSubmited || createAnnoucmentForm.get('title')?.touched) && createAnnoucmentForm.get('title')?.errors?.['maxlength']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> Le titre ne doit pas dépasser 20 caractères.
              </div>

            </div>

            <!-- Ligne 1: Catégorie et État -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- Catégorie -->
              <div>
                <label for="category_id" class="block text-sm font-semibold text-[#7A4100] mb-2">Catégorie</label>
                <select
                  id="category_id"
                  formControlName="category_id"
                  class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 appearance-none bg-white"
                  [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('category_id')?.touched) && createAnnoucmentForm.get('category_id')?.invalid"
                  style="background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 4 5%22><path fill=%22%23FF9000%22 d=%22M2 0L0 2h4zm0 5L0 3h4z%22/></svg>'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 0.65rem;"
                >
                  <option value="" disabled selected>-- Sélectionnez une catégorie --</option>
                  <option *ngFor="let category of categories" [value]="category.id">
                    {{ category.name }}
                  </option>
                </select>
                <div *ngIf="(isSubmited || createAnnoucmentForm.get('category_id')?.touched) && createAnnoucmentForm.get('category_id')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                  <span class="font-medium">Erreur :</span> Veuillez sélectionner une catégorie.
                </div>
              </div>

              <!-- État -->
              <div>
                <label for="state" class="block text-sm font-semibold text-[#7A4100] mb-2">État du produit</label>
                <select
                  id="state"
                  formControlName="state"
                  class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 appearance-none bg-white"
                  [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('state')?.touched) && createAnnoucmentForm.get('state')?.invalid"
                  style="background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 4 5%22><path fill=%22%23FF9000%22 d=%22M2 0L0 2h4zm0 5L0 3h4z%22/></svg>'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 0.65rem;"
                >
                  <option value="" disabled selected>-- Sélectionnez --</option>
                  <option value="new">Neuf</option>
                  <option value="like new">Comme neuf</option>
                  <option value="damaged">Abimé</option>
                  <option value="good">Bon état</option>
                </select>
                <div *ngIf="(isSubmited || createAnnoucmentForm.get('state')?.touched) && createAnnoucmentForm.get('state')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                  <span class="font-medium">Erreur :</span> Veuillez sélectionner l'état du produit.
                </div>
              </div>
            </div>

            <!-- Prix (affiché conditionnellement pour la vente) -->
            <div *ngIf="createAnnoucmentForm.get('operation_type')?.value === 'sale'">
              <label for="price" class="block text-sm font-semibold text-[#7A4100] mb-2">Prix</label>
              <input
                id="price"
                type="number"
                formControlName="price"
                placeholder="Ex: 10000"
                class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white"
                [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('price')?.touched) && createAnnoucmentForm.get('price')?.invalid"
              />
              <div *ngIf="(isSubmited || createAnnoucmentForm.get('price')?.touched) && createAnnoucmentForm.get('price')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> Le prix est requis pour une vente.
              </div>
            </div>

            <!-- Description détaillée -->
            <div>
              <label for="desc" class="block text-sm font-semibold text-[#7A4100] mb-2">Description</label>
              <textarea
                id="desc"
                formControlName="description"
                placeholder="Décrivez votre article..."
                rows="4"
                class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white resize-none"
                [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('description')?.touched) && createAnnoucmentForm.get('description')?.invalid"
              ></textarea>
              <div *ngIf="(isSubmited || createAnnoucmentForm.get('description')?.touched) && createAnnoucmentForm.get('description')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> La description est requise.
              </div>
            </div>
          </div>
        </div>

        <!-- Section 3: Localisation -->
        <div class="bg-[#FFDFC8] p-6 rounded-xl border border-[#FFD0A9]">
          <div class="flex items-center gap-4 mb-6">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#FF9000] text-white font-bold text-2xl">
              3
            </div>
            <h2 class="text-[#7A4100] text-2xl font-bold">Localisation</h2>
          </div>

          <div class="space-y-6">
            <!-- Adresse -->
            <div>
              <label for="exchangeAddress" class="block text-sm font-semibold text-[#7A4100] mb-2">Adresse d'échange</label>
              <input
                id="exchangeAddress"
                type="text"
                formControlName="exchange_location_address"
                placeholder="Entrez l'adresse de rencontre"
                class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white"
                [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('exchange_location_address')?.touched) && createAnnoucmentForm.get('exchange_location_address')?.invalid"
              />
              <div *ngIf="(isSubmited || createAnnoucmentForm.get('exchange_location_address')?.touched) && createAnnoucmentForm.get('exchange_location_address')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                <span class="font-medium">Erreur :</span> L'adresse d'échange est requise.
              </div>
            </div>

            <!-- Latitude & Longitude -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label for="exchangeLat" class="block text-sm font-semibold text-[#7A4100] mb-2">Latitude</label>
                <input
                  id="exchangeLat"
                  type="text"
                  formControlName="exchange_location_lat"
                  placeholder="Ex: 48.8566"
                  class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white"
                  [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('exchange_location_lat')?.touched) && createAnnoucmentForm.get('exchange_location_lat')?.invalid"
                />
                <div *ngIf="(isSubmited || createAnnoucmentForm.get('exchange_location_lat')?.touched) && createAnnoucmentForm.get('exchange_location_lat')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                  <span class="font-medium">Erreur :</span> La latitude est requise.
                </div>
              </div>
              <div>
                <label for="exchangeLng" class="block text-sm font-semibold text-[#7A4100] mb-2">Longitude</label>
                <input
                  id="exchangeLng"
                  type="text"
                  formControlName="exchange_location_lng"
                  placeholder="Ex: 2.3522"
                  class="w-full px-5 py-3 border border-[#FFD0A9] rounded-xl focus:ring-2 focus:ring-[#FF9000] focus:outline-none text-gray-700 bg-white"
                  [class.border-red-500]="(isSubmited || createAnnoucmentForm.get('exchange_location_lng')?.touched) && createAnnoucmentForm.get('exchange_location_lng')?.invalid"
                />
                <div *ngIf="(isSubmited || createAnnoucmentForm.get('exchange_location_lng')?.touched) && createAnnoucmentForm.get('exchange_location_lng')?.errors?.['required']" class="mt-2 text-sm text-red-600">
                  <span class="font-medium">Erreur :</span> La longitude est requise.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section 4: Photos -->
        <div class="bg-[#FFDFC8] p-6 rounded-xl border border-[#FFD0A9]">
          <div class="flex items-center gap-4 mb-6">
            <div class="flex items-center justify-center w-12 h-12 rounded-full bg-[#FF9000] text-white font-bold text-2xl">
              4
            </div>
            <h2 class="text-[#7A4100] text-2xl font-bold">Photos</h2>
          </div>

          <div class="flex items-center justify-center w-full">
            <label
              for="dropzone-file"
              class="relative flex flex-col items-center justify-center w-full h-64 border-2 border-[#FFD0A9] border-dashed rounded-xl cursor-pointer bg-white hover:bg-[#FFF5EE] transition-colors"
            >
              <!-- Zone preview des images -->
              <div
                *ngIf="previewImages.length"
                class="absolute top-0 left-0 w-full h-full p-2 overflow-auto flex flex-wrap gap-2 bg-white bg-opacity-90 z-10 rounded-xl"
              >
                <div *ngFor="let url of previewImages; let i = index" class="relative">
                  <img
                    [src]="url"
                    class="w-20 h-20 object-cover rounded-lg border border-[#FFD0A9] shadow-sm"
                    alt="Preview"
                  />
                  <button
                    type="button"
                    (click)="removeImage(i)"
                    class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm hover:bg-red-600 transition-colors"
                    title="Supprimer"
                  >
                    ×
                  </button>
                </div>
              </div>

              <!-- Icône et instructions -->
              <div
                class="flex flex-col items-center justify-center pt-5 pb-6"
                *ngIf="!previewImages.length"
              >
                <svg
                  class="w-10 h-10 mb-4 text-[#FF9000]"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 20 16"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"
                  />
                </svg>
                <p class="mb-2 text-sm text-[#FF9000]">
                  <span class="font-semibold">Cliquez pour importer</span> ou glissez-déposez
                </p>
                <p class="text-xs text-[#FF9000]/80">
                  PNG, JPG ou GIF (MAX. 800x400px)
                </p>
              </div>

              <input
                id="dropzone-file"
                type="file"
                multiple
                (change)="onFileChange($event)"
                class="hidden"
              />
            </label>
          </div>

          <!-- Message informatif pour les photos (optionnel) -->
          <div class="mt-2 text-sm text-gray-600">
            <span class="font-medium">Info :</span> Les photos sont optionnelles mais recommandées pour attirer plus d'acheteurs.
          </div>
        </div>

        <!-- Bouton de soumission -->
        <div class="pt-4">
          <button
            type="submit"
            class="w-full bg-gradient-to-r from-[#FF9000] to-[#FF7A00] hover:from-[#FF7A00] hover:to-[#FF6600] text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.02]"
          >
            Créer l'annonce
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<app-footer></app-footer>
